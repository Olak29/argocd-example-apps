# # Test with multi-source applicationsets

applicationsets:
  applicationset-multiple-sources:
    generators:
    - list:
        elements:
          - cluster: local-cluster
            url: https://kubernetes.default.svc
    template:
      metadata:
        name: '{{cluster}}-apps'
      spec:
        project: default
        sources:
        - repoURL: https://github.com/Olak29/argocd-example-apps.git 
          path: applications
          targetRevision: HEAD
          helmFiles:
            valuesFiles:
            - applications/guestbook
        destination:
          server: '{{url}}'
          namespace: default
        syncPolicy:
         syncOptions:
          - ApplyOutOfSyncOnly=true
          - CreateNamespace=true
         automated:
            prune: true
            selfHeal: true
            allowEmpty: false
# # Test with multi-source applicationsets

# applicationsets:
#   guestbook:
#     namespace: argo-cd
#     generators:
#     - list:
#         elements:
#           - cluster: local-cluster
#             url: https://kubernetes.default.svc
#             path: "appss/guestbook"
#     template:
#       metadata:
#         name: '{{path.basename}}'
#       spec:
#         project: default
#         sources:
#         - repoURL: https://github.com/Olak29/argocd-example-apps.git 
#           path: '{{path}}'
#           targetRevision: HEAD
#         destination:
#           server: '{{url}}'
#           namespace: '{{path.base}}'
#         syncPolicy:
#          syncOptions:
#           - ApplyOutOfSyncOnly=true
#           - CreateNamespace=true
#          automated:
#             prune: true
#             selfHeal: true
#             allowEmpty: false    
  # applicationset-list-generator:
  #   generators:
  #   - list:
  #       elements:
  #         - cluster: engineering-dev
  #           url: https://kubernetes.default.svc
  #       template:
  #         metadata: {}
  #         spec:
  #           project: '{{cluster}}'
  #           source:
  #             targetRevision: HEAD
  #             repoURL: https://github.com/argoproj/argo-cd.git
  #             # New path value is generated here:
  #             path: 'applicationset/examples/template-override/{{cluster}}-override'
  #           destination: {}
  #   template:
  #     metadata:
  #       name: '{{cluster}}-guestbook'
  #     spec:
  #       project: '{{cluster}}'
  #       source:
  #         repoURL: https://github.com/argoproj/argo-cd.git
  #         targetRevision: HEAD
  #         # This 'default' value is not used: it is is replaced by the generator's template path, above
  #         path: applicationset/examples/template-override/default
  #       destination:
  #         server: '{{url}}'
  #         namespace: guestbook